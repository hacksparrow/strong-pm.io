<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>StrongLoop Process Manager</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,300italic,400italic,500italic">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu+Mono">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/main.css">
    <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-placeholder/2.0.7/jquery.placeholder.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/0.6.11/fastclick.min.js"></script>
    <script src="/js/prism.js"></script><script>$('input, textarea').placeholder();</script>
    <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.min.js"></script><![endif]-->
    <script src="/js/main.js"></script>
  </head>
  <body class="l-page-getting-started -getting-started-index js-body">
  <!-- Google Tag Manager -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5XL76H"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5XL76H');</script>
  <!-- End Google Tag Manager -->
    <div class="c-wrapper js-wrapper">
      <header class="c-masthead">
        <div class="c-container x-flex-v js-masthead-container">
          <a href="/" class="_logo x-flex-v">
            <h1 class="c-heading -h3">StrongLoop<br/> Process Manager</h1>
          </a>
          <nav class="_nav js-masthead-nav">
            <ul class="_nav-list js-nav-list">
              <li class="_nav-item"><a href="/">About</a></li>
              <li class="_nav-item "><a href="/getting-started">Getting started</a></li>
              <li class="_nav-item -active"><a href="/prod">Use in Production</a></li>
              <li class="_nav-item"><a href="/resources">Resources</a></li>
            </ul>
          </nav>
          <button class="_menu js-menu">
            <i class="fa fa-bars"></i>
            <span class="x-hide">Menu</span>
          </button>
          <iframe src="http://ghbtns.com/github-btn.html?user=strongloop&repo=strong-pm&type=watch&count=true" class="c-github-star js-github-star"></iframe>
        </div>
      </header>

      <main class="c-content">
        <section class="c-section">
          <div class="c-container -padded">
            <h1 class="c-heading -h2">Deploying remotely to production</h1>
            <p></p>
          </div>
        </section>

        <section class="c-section x-greylight"><a name="prod"></a>
          <div class="c-container -padded">
            <h2 class="c-heading -h3">Install on production host</h2>
            <div class="c-grid">
              <div class="_col -col-1-1">
                <p>Install StrongLoop Process Manager on a production host using either npm or Docker.
                Then you can remotely deploy and control your app using the StrongLoop client tools (Arc or slc).  Either:
                </p>
                <ul>
                  <li><a href="#npm-install">Install with npm</a></li>
                  <li><a href="#docker">Install with Docker Hub</a></li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section "><a name="npm-install"></a>
          <div class="c-container -padded">
            <h2 class="c-heading -h4">Install with npm and run as a service </h2>

            <div class="c-grid">
              <div class="_col -col-1-2">
                <p>Install StrongLoop Process Manager from npm:</p>
              </div>
              <div class="_col -col-1-2">
                <pre><code class="language-bash">$ npm install -g strong-pm</code></pre>
              </div>
            </div>

            <div class="c-grid" style="margin-bottom: 10px;">
              <div class="_col -col-1-1">
                <p>On Linux distributions that support <b>Upstart</b> or <b>systemd</b>, run Process Manager as a service
                to ensure it starts when the system boots, aggregates logs properly, and so on.</p>
                <br/>
              </div>

              <div class="_col -col-1-3">
                <p>Ubuntu 12.04+:</p>
              </div>
              <div class="_col -col-2-3">
                <pre><code class="language-bash">$ sudo sl-pm-install</code></pre>
              </div>
            </div>

            <div class="c-grid" style="margin-bottom: 10px;">
              <div class="_col -col-1-3">
                <p>Red Hat Enterprise Linux 7+:</p>
              </div>
              <div class="_col -col-2-3">
                <pre><code class="language-bash">$ sudo sl-pm-install --systemd</code></pre>
              </div>
            </div>

            <div class="c-grid">
              <div class="_col -col-1-3">
                <p>Red Hat Enterprise Linux  5 and 6:</p>
              </div>
              <div class="_col -col-2-3">
                <pre><code class="language-bash">$ sudo sl-pm-install --upstart=0.6 </code></pre>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section x-greylight"><a name="docker"></a>
          <div class="c-container -padded">
            <h2 class="c-heading -h4">OR Install with Docker Hub </h2>

            <div class="c-grid">
              <div class="_col -col-1-1">
                Run StrongLoop PM as an OS service without installing anything. All you need is Docker!
                </p><p>
                Run the script below to download the image, start a StrongLoop PM container, and create an Upstart
                or systemd config file.  The app will use port 3000; StrongLoop PM will use port 8701 and will
                automatically restart if your server reboots.
              </div>
              <div class="_col -col-1-1">
                <pre><code class="language-bash">$ curl -s https://strong-pm.io/docker.sh | sudo /bin/sh</code></pre>
              </div>
            </div>
            <div class="_col -col-1-1">
              <p>For more information on Docker and Docker Hub, see <a href="https://www.docker.com/">https://www.docker.com</a>.</p>
            </div>
          </div>
        </section>

        <section class="c-section ">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> Build your application </h2>

            <p class="note">NOTE: This assumes you followed <a href="http://localhost:3000/getting-started/">Getting Started</a>
            to install StrongLoop on your workstation and have a Node app to deploy.</p>

            <p>Back on your workstation, you're going to build your app for deployment.
            You can either build a .tgz (tar file) or build to a Git branch.
            </p>

            <div class="c-grid">
              <div class="_col -col-1-1">
                <p>If your project code is in a Git repository, then by default <span style="font-family: monospace;">slc build</span>
                will commit to a 'deploy' branch in Git.<br/>
                 See <a href="http://docs.strongloop.com/display/SLC/Committing+a+build+to+Git">Committing a build to Git</a> for details.
                </p>
              </div>
              <div class="_col -col-1-1">
<pre><code class="language-bash">$ slc build
Running `git add --force --all .`
Running `git write-tree`
  => 11476565ef4903367a5b545438ecfb4d2b0a2404
Running `git commit-tree -p "refs/heads/deploy" -m "Commit build products" 11476565ef4903367a5b545438ecfb4d2b0a2404`
Running `git update-ref "refs/heads/deploy" ca436bfcf83517da7d943d4c90427c071af4e9d8`
Committed build products onto `deploy`
</code></pre>
              </div>
            </div>
<br/>
            <div class="c-grid">
              <div class="_col -col-1-1">
                <p>If your project code is not in a Git repository, then by default <span style="font-family: monospace;">slc build</span>
                will build a .tgz archive.<br/>
                See <a href="http://docs.strongloop.com/display/SLC/Creating+a+build+archive">Committing a build to Git</a> for details.
                </p>
              </div>
              <div class="_col -col-1-1">
<pre><code class="language-bash">$ slc build
Running `npm install --ignore-scripts`
Running `npm prune --production`
Running `npm --quiet pack`
Running `mv -f profiling-app-0.0.1.tgz ../profiling-app-0.0.1.tgz`
</code></pre>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section x-greylight">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> Deploy to remote host </h2>
            <div class="c-grid">
              <div class="_col -col-1-3">
            <p>Deploy the app package .tgz to the remote StrongLoop PM.</p>
              </div>
              <div class="_col -col-2-3">
                <pre><code class="language-bash">$ slc deploy http://your.remote.host ../express-example-app-1.0.0.tgz</code></pre>
              </div>
            </div>
<br/>
            <div class="c-grid">
              <div class="_col -col-1-3">
            <p>Alternatively, deploy the Git 'deploy' branch....</p>
              </div>
              <div class="_col -col-2-3">
                <pre><code class="language-bash">$ slc deploy http://your.remote.host</code></pre>
              </div>
            </div>

            <div class="c-grid">
              <div class="_col -col-1-1">
                <p>Your app is now deployed!</p>
                <p>Open <a href="http://your.remote.host:3000">http://your.remote.host:3000</a> to see the app in your browser.</p>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section ">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> Display app status </h2>

            <div class="c-grid">
              <div class="_col -col-1-1">
                <p>Get a quick status overview with all worker PIDs, cluster IDs, other key information.</p>

               <!-- <p>NOTE: By default, StrongLoop PM control endpoint uses port 8701.</p>  -->

              </div>
            </div><div class="c-grid">
              <div class="_col -col-1-1">
                <pre><code class="language-bash">$ slc ctl --control http://your.remote.host
manager:
  pid:                22642
  port:               8701
  base:               /Users/rand/.strong-pm
  config:             undefined
current:
  status:             started
  pid:                22669
  link:               /Users/rand/StrongLoop/express-example-app
  current:            826d11fe9a7f5b04e586.1426200263251
  branch:             npm-pack
  worker count:       4
    [1]:              cluster id 1, pid 22670
    [2]:              cluster id 2, pid 22671
    [3]:              cluster id 3, pid 22672
    [4]:              cluster id 4, pid 22673
  config:             default
    start command:    sl-run --cluster=CPU
    stop signal:      SIGTERM
    replace signal:   SIGHUP
</code></pre>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section x-greylight">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> Change cluster size  </h2>
            <div class="c-grid">
              <div class="_col -col-1-3">
            <p>By default the Process Manager runs one process per CPU.  So, on a four-core system
            it will run the app in a four-process cluster.
            </p>
            <p>You can easily change the cluster size.  For example, set the cluster to two worker processes.</p>
              </div>
              <div class="_col -col-2-3">
                <pre><code class="language-bash">$ slc ctl --control http://your.remote.host set-size 2</code></pre>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section ">
          <div class="c-container -padded">
            <h2 class="c-heading -h4">Re-deploy app with zero downtime  </h2>
            <div class="c-grid" >
              <div class="_col -col-1-2">
                <p>When your code changes, simply rebuild and re-deploy it to the production host.
                  StrongLoop Process Manager automatically performs a rolling restart of all processes, so you get zero downtime.
                </p>
              </div>
              <div class="_col -col-1-2">
                <pre><code class="language-bash"> $ slc deploy http://your.remote.host </code></pre>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section x-greylight">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> Generate logs </h2>

            <div class="c-grid">
              <div class="_col -col-1-3">
                Dump the log buffer to stdout.
                <!-- Show a different log example here? -->
              </div>
              <div class="_col -col-2-3" style="margin-bottom: 10px;">
                <pre><code class="language-bash">$ slc ctl --control http://your.remote.host log-dump --follow </code></pre>
              </div>

              <div class="_col -col-1-1">
                <pre><code class="language-markup" style="font-size: 85%">2015-03-13T23:37:19.265Z pid:36620 worker:0 INFO supervisor starting (pid 36620)
2015-03-13T23:37:19.265Z pid:36620 worker:0 INFO supervisor reporting metrics to `internal:`
2015-03-13T23:37:19.267Z pid:36620 worker:0 INFO supervisor size set to 4
2015-03-13T23:37:19.271Z pid:36620 worker:0 INFO supervisor listening on 'runctl'
2015-03-13T23:37:19.344Z pid:36620 worker:0 INFO supervisor started worker 1 (pid 36621)
2015-03-13T23:37:19.476Z pid:36620 worker:0 INFO supervisor started worker 2 (pid 36622)
2015-03-13T23:37:19.610Z pid:36620 worker:0 INFO supervisor started worker 3 (pid 36623)
2015-03-13T23:37:19.869Z pid:36620 worker:0 INFO supervisor started worker 4 (pid 36624)
2015-03-13T23:37:19.869Z pid:36620 worker:0 INFO supervisor resized to 4
2015-03-13T23:37:29.459Z pid:36621 worker:1 Browse your REST API at http://localhost:3000/explorer
2015-03-13T23:37:29.459Z pid:36621 worker:1 Web server listening at: http://localhost:3000/
2015-03-13T23:37:29.460Z pid:36622 worker:2 Browse your REST API at http://localhost:3000/explorer
2015-03-13T23:37:29.460Z pid:36622 worker:2 Web server listening at: http://localhost:3000/
2015-03-13T23:37:29.460Z pid:36624 worker:4 Browse your REST API at http://localhost:3000/explorer
2015-03-13T23:37:29.460Z pid:36624 worker:4 Web server listening at: http://localhost:3000/
2015-03-13T23:37:29.460Z pid:36623 worker:3 Browse your REST API at http://localhost:3000/explorer
2015-03-13T23:37:29.460Z pid:36623 worker:3 Web server listening at: http://localhost:3000/
2015-03-13T23:37:49.302Z pid:36620 worker:0 WARN received SIGHUP, restarting workers
2015-03-13T23:37:49.316Z pid:36620 worker:0 ERROR supervisor worker id 1 (pid 36621) expected exit with 2
2015-03-13T23:37:49.372Z pid:36620 worker:0 INFO supervisor started worker 5 (pid 36628)
2015-03-13T23:37:49.372Z pid:36620 worker:0 INFO supervisor resized to 4
2015-03-13T23:37:50.573Z pid:36628 worker:5 Browse your REST API at http://localhost:3000/explorer
2015-03-13T23:37:50.573Z pid:36628 worker:5 Web server listening at: http://localhost:3000/
2015-03-13T23:37:51.389Z pid:36620 worker:0 ERROR supervisor worker id 2 (pid 36622) expected exit with 2
2015-03-13T23:37:51.442Z pid:36620 worker:0 INFO supervisor started worker 6 (pid 36629)
2015-03-13T23:37:51.442Z pid:36620 worker:0 INFO supervisor resized to 4
2015-03-13T23:37:52.611Z pid:36629 worker:6 Browse your REST API at http://localhost:3000/explorer
2015-03-13T23:37:52.611Z pid:36629 worker:6 Web server listening at: http://localhost:3000/
2015-03-13T23:37:53.458Z pid:36620 worker:0 ERROR supervisor worker id 3 (pid 36623) expected exit with 2
2015-03-13T23:37:53.511Z pid:36620 worker:0 INFO supervisor started worker 7 (pid 36630)
2015-03-13T23:37:53.511Z pid:36620 worker:0 INFO supervisor resized to 4
2015-03-13T23:37:54.658Z pid:36630 worker:7 Browse your REST API at http://localhost:3000/explorer
2015-03-13T23:37:54.659Z pid:36630 worker:7 Web server listening at: http://localhost:3000/
2015-03-13T23:37:55.525Z pid:36620 worker:0 ERROR supervisor worker id 4 (pid 36624) expected exit with 2
2015-03-13T23:37:55.600Z pid:36620 worker:0 INFO supervisor started worker 8 (pid 36632)
2015-03-13T23:37:55.600Z pid:36620 worker:0 INFO supervisor resized to 4</code></pre>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section x-greylight">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> Set up secure access  </h2>

            <div class="c-grid">
              <div class="_col -col-1-2">
                <p>You may have noticed that slc has been connecting to your production server over HTTP.
                Of course, you don't want to allow just anyone to deploy to and control your server, so you need to set up secure access.
                Fortunately, StrongLoop PM supports secure connections using SSH.</p>

                <p>First, you have to set up SSH key-based authentication.
                Many developers will already have this configured for secure access to GitHub and remote servers.
                See <a href="https://help.github.com/articles/generating-ssh-keys/">Generating SSH keys</a> if you need some guidance. </p>
                <p>Then you just need to set some environment variables, and from then on you can use <span class="cmd">http+ssh</span>
                instead of plain old HTTP to control and deploy securely to your server.  </p>
              </div>
              <div class="_col -col-1-2">
                <pre><code class="language-bash">$ export SSH_USER=ubuntu
$ export SSH_KEY=~/.ssh/ec2.rsa
$ slc deploy http+ssh://the.remote.host
$ slc ctl -C http+ssh://the.remote.host status</code></pre>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section ">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> View CPU and memory profiles </h2>

            <div class="c-grid">
              <div class="_col -col-1-1" >
                <p>If you haven't already done so, set up your StrongLoop license properly for profiling and viewing metrics.
                See <a href="/getting-started#license">Getting Started </a> for instructions.</p>
              </div>
              <div class="_col -col-1-1" >
                <p class="note">NOTE: For profiling and metrics, you must have C compiler tools on the system running the app.
                These come standard on most Linux systems.  See <a href="http://docs.strongloop.com/display/SL/Installing+compiler+tools">Installing compiler tools</a>.</p>
              </div>
            </div>
<br/>
            <div class="c-grid">
              <div class="_col -col-1-2">
                <ol>
                  <li>On your local (development) system, start StrongLoop Arc.</li>
                  <li>Log in, if you're not already logged in.</li>
                </ol>
                <p>You'll see the StrongLoop Arc splash screen:</p>
              </div>
              <div class="_col -col-1-2">
                <pre><code class="language-bash">$ slc arc</code></pre>
              </div>
            </div>

            <div class="c-grid" style="margin-top: 10px;">
              <div class="_col -col-2-3" >
                <img src="http://docs.strongloop.com/download/attachments/5308533/arc%20splash.png?version=1&modificationDate=1424798146000&api=v2" class="c-fleximg" />
              </div>
            </div>
<br/>
            <div class="c-grid">
              <div class="_col -col-1-2">
               <ol>
                  <li>Click <b>Profiler</b>.</li>
                  <li>Enter the host name of your production system and the port on which StrongLoop PM is running (8701 by default).</li>
                  <li>Click <b>Load</b> to load.  You'll see the PIDs of the app processes; the first one is selected by default.</li>
                  <li>"JavaScript/Node.js CPU Profile" is selected by default. Click <b>Start</b> to start CPU profiling the
                  first worker process.  Wait about five seconds then click <b>Stop</b>.</li>
                  <li>Select "Heap Snapshot" and repeat the process</li>
                  <li>Each time you do this, the profile is added to the <b>Profiles</b> list on the left. Select each profile in the
                  list to view it; for example as shown below.</li>
                </ol>
              </div>
              <div class="_col -col-1-2">
                <img src="/images/arc-profile-target.png" class="c-fleximg" />
              </div>
            </div>

            <div class="c-grid">
              <div class="_col -col-3-4">
                <img src="/images/arc profiler 1.1.png" class="c-fleximg"/>
              </div>
            </div>
          </div>
        </section>

        <section class="c-section x-greylight">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> Monitor app performance metrics with Arc </h2>

            <div class="c-grid ">
              <div class="_col -col-1-2">
                <ol>
                  <li>Click <b>Metrics</b> to view Metrics.</li>
                  <li>Enter the host name of your production system and the port on which StrongLoop PM is running (8701 by default).</li>
                </ol>
              </div>
              <div class="_col -col-1-2">
                <img src="/images/arc-remote-metrics.png" class="c-fleximg" />
              </div>
            </div>
<br/>
            <div class="c-grid">
              <div class="_col -col-3-4">
                 <p>Arc will display the process IDs (PIDs) for the app running on the remote host and select the first PID,
                   then display peformance metrics, including statistics on CPU use, event loop execution, and heap memory consumption.</p>
                  <p>For details on the available metrics,
                  see <a href="http://docs.strongloop.com/display/SLC/Viewing+metrics+with+Arc#ViewingmetricswithArc-Availablemetrics">Available metrics</a>.</p>
                <img src="http://docs.strongloop.com/download/attachments/4557583/remote%20metrics.png?version=1&api=v2" class="c-fleximg"/>
              </div>
            </div>
          </div>
        </section>


        <section class="c-section x-greylight">
          <div class="c-container -padded">
            <h2 class="c-heading -h4"> Set up load balancer </h2>
            <div class="c-grid">
              <div class="_col -col-1-2"><p>Assuming you have already <a href="http://nginx.org/en/download.html">installed Nginx</a>....</p></div>
            </div>

            <div class="c-grid">
              <div class="_col -col-1-2">
                <p>Run the StrongLoop Nginx Controller service.</p>
                <p>Add the load balancer in Arc:</p>
                <ul>
                  <li>Click <b>Process Manager</b>.</li>
                  <li>Add all your Process Manager hosts.</li>
                  <li>Click <b>Load Balancer</b>.  Enter the Nginx load balancer host and port.</li>
                </ul>
              </div>
              <div class="_col -col-1-2">
                <pre><code class="language-bash">$ npm install -g strong-nginx-controller</code></pre>
                <pre><code class="language-bash">$ sl-nginx-ctl-install</code></pre>
              </div>
            </div>
<br/>
            <div class="c-grid">
              <div class="_col -col-1-2">
                <img src="http://docs.strongloop.com/download/attachments/5310901/arc-lb-setup.png?version=1&api=v2" class="c-fleximg"/>
              </div>
            </div>
          </div>
        </section>

      </main>
      <footer class="c-footer x-green">
        <div class="c-container -padded">
          <nav class="_nav">
            <ul class="_nav-list js-nav-list">
              <li class="_nav-item"><a href="/">About</a></li>
              <li class="_nav-item -active"><a href="/getting-started">Getting started</a></li>
              <li class="_nav-item"><a href="/examples">Examples</a></li>
              <li class="_nav-item"><a href="/resources">Resources</a></li>
              <!-- <li class="_nav-item"><a href="/users">Who's using?</a></li> -->

              <li class="_nav-item"><a href="https://github.com/strongloop/loopback">GitHub</a></li>
            </ul>
          </nav>
          <p class="_copyright">© Copyright 2015 StrongLoop, Inc.</p>
          <iframe src="http://ghbtns.com/github-btn.html?user=strongloop&amp;repo=loopback&amp;type=follow" class="c-github-follow"></iframe>
        </div>
      </footer>
    </div>
  </body>
</html>
